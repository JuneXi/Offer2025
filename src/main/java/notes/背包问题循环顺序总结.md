# 背包问题循环顺序总结（如何确定内外循环）

统一说明各种背包问题在动态规划中的循环结构。

---

## 一、核心总览表

| 背包类型 | 每个物品可用次数 | 外层循环 | 内层循环方向 | 原因解释 |
|-----------|------------------|-----------|----------------|------------|
| **0-1 背包** | 每种物品最多 1 次 | 物品 | `j = W → w[i]`（**倒序**） | 倒序防止同一物品被重复使用（覆盖旧状态） |
| **完全背包** | 每种物品无限次 | 物品 | `j = w[i] → W`（**正序**） | 正序允许当前物品重复使用 |
| **多重背包** | 每种物品有限次 | 物品（或拆分子物品） | `j = W → w[i]`（**倒序**） | 分解后相当于多个 0-1 物品 |
| **分组背包** | 每组最多选 1 个 | 组 | `j = W → 0`（**倒序**） | 同组物品不能共存 |
| **二维背包（如 findMaxForm）** | 每件物品最多 1 次 | 物品 | `i = M → 0`, `j = N → 0`（**双倒序**） | 防止同一物品重复加入 |
| **硬币找零 - 组合数** | 每种硬币无限次 | 硬币 | `sum = coin → amount`（**正序**） | 完全背包计数，顺序不敏感 |
| **硬币找零 - 排列数** | 每种硬币无限次 | 金额 | `for coin : coins`（**内层**） | 顺序敏感，每个金额累加前驱 |
| **硬币找零 - 最少硬币数** | 每种硬币无限次 | 硬币 | `sum = coin → amount`（**正序**） | 完全背包最优化问题 |

---

## 二、通用规律

1. **外层循环是谁**
   - “物品只能用一次” → 外层是 **物品**（0-1 背包）  
   - “物品可重复用” → 外层仍是 **物品**（完全背包）  
   - “组合问题（顺序不敏感）” → 外层是 **物品/硬币**  
   - “排列问题（顺序敏感）” → 外层是 **容量/金额**

2. **内层循环方向**
   - **倒序**：防止重复使用（0-1 背包）  
   - **正序**：允许重复使用（完全背包）

---

## 三、代码模板

### 0-1 背包模板
```java
for (item in items)
    for (j = W; j >= w[item]; j--)
        dp[j] = Math.max(dp[j], dp[j - w[item]] + v[item]);
```

### 完全背包模板
```java
for (item in items)
    for (j = w[item]; j <= W; j++)
        dp[j] = Math.max(dp[j], dp[j - w[item]] + v[item]);
```

### 硬币找零（组合数）
```java
dp[0] = 1;
for (coin in coins)
    for (sum = coin; sum <= amount; sum++)
        dp[sum] += dp[sum - coin];
```

### 硬币找零（排列数）
```java
dp[0] = 1;
for (sum = 1; sum <= amount; sum++)
    for (coin in coins)
        if (sum >= coin) dp[sum] += dp[sum - coin];
```

---

## 四、口诀记忆

> **外物内容量，倒序防重复，正序可多取；  
> 组合物外层，排列容量先。**

---

## 五、总结

确定循环顺序的核心是：
1. 是否允许重复使用物品。  
2. 是否与顺序有关（组合 / 排列）。  
3. 是否存在分组或多维约束。  

掌握这三点，任何背包类 DP 都能正确设置循环结构。
